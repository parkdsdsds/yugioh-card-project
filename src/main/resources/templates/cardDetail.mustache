<!DOCTYPE html>
<html>
<head>
    <title>{{name}}</title>
</head>
<body>
<h1>{{name}}</h1>
<img src="{{imageUrl}}" alt="{{name}}" style="width:200px;"><br>
<p>ì†ì„±: {{attribute}}</p>
<p>íƒ€ì…: {{type}}</p>
<p>ë ˆë²¨: {{level}}</p>
<p>{{desc}}</p>

<hr>
<h2>ëŒ“ê¸€ ëª©ë¡</h2>

{{#comments}}
    <div style="border:1px solid #ccc; padding:10px; margin:5px;">
        <strong>{{username}}</strong> - <em>{{createdAt}}</em><br>
        {{content}}
        {{#isMine}}
            <!-- ë³¸ì¸ ëŒ“ê¸€ë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ -->
            <button onclick="showEditForm({{id}}, '{{content}}')">ìˆ˜ì •</button>
            <button onclick="deleteComment({{id}})">ì‚­ì œ</button>
        {{/isMine}}
    </div>
{{/comments}}

{{^comments}}
    <p>ğŸ“­ ëŒ“ê¸€ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>
{{/comments}}

<hr>
<h2>ëŒ“ê¸€ ì‘ì„±</h2>

{{#isAuthenticated}}
    <form method="post" action="/api/cards/{{id}}/comments">
        <textarea name="content" rows="4" cols="50" required></textarea><br>
        <button type="submit">ëŒ“ê¸€ ë“±ë¡</button>
    </form>
{{/isAuthenticated}}

{{^isAuthenticated}}
    <p>âœëŒ“ê¸€ ì‘ì„±ì„ í•˜ë ¤ë©´ <a href="/login">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
{{/isAuthenticated}}

<script>
    function deleteComment(commentId) {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        fetch(`/api/cards/{{id}}/comments/` + commentId, {
            method: 'DELETE',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            credentials: 'include'
        })
                .then(res => {
                    if(res.ok) window.location.reload();
                    else alert("ì‚­ì œ ì‹¤íŒ¨");
                });
    }

    function showEditForm(commentId, content) {
        const newContent = prompt("ëŒ“ê¸€ ìˆ˜ì •", content);
        if(newContent === null) return;
        fetch(`/api/cards/{{id}}/comments/` + commentId, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            credentials: 'include',
            body: JSON.stringify({content: newContent})
        })
                .then(res => {
                    if(res.ok) window.location.reload();
                    else alert("ìˆ˜ì • ì‹¤íŒ¨");
                });
    }
</script>
</body>
</html>
