<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{name}} - 카드 상세 정보</title>
    <style>
        body { font-family: sans-serif; margin: 2em; color: #333; }
        .card-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .card-image img { max-width: 300px; border-radius: 10px; }
        .card-info { max-width: 500px; }
        .comment-form textarea, .edit-form textarea { width: 98%; padding: 5px; }
        .comment { border-top: 1px solid #eee; padding: 15px 0; }
        .comment-content, .edit-form { margin: 10px 0; }
        .hidden { display: none; }
        button { padding: 5px 10px; border: 1px solid #ccc; background-color: #f7f7f7; cursor: pointer; border-radius: 4px; }
        button:hover { background-color: #e7e7e7; }
        .actions button { margin-right: 5px; }

        /* 목록으로 돌아가기 버튼 스타일 추가 */
        .back-to-list-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 8px 15px;
            background-color: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 14px;
        }
        .back-to-list-button:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>

<a href="/cards" class="back-to-list-button">← 목록으로 돌아가기</a>

<h1>{{name}}</h1>

<div class="card-container">
    <div class="card-image">
        <img src="{{imageUrl}}" alt="{{name}}">
    </div>
    <div class="card-info">
        <p><strong>속성:</strong> {{attribute}} | <strong>종류:</strong> {{type}} | <strong>레벨:</strong> {{level}}</p>
        <p><strong>평균 평점:</strong> <strong>{{averageScore}}</strong> / 5.0</p>
        <hr>
        <p><strong>효과:</strong><br>{{desc}}</p>
    </div>
</div>

<hr>

{{#isAuthenticated}}
    <div>
        <h3>평점 등록/수정</h3>
        <form action="/api/cards/{{cardId}}/ratings" method="post">
            <label for="rating-score">점수:</label>
            <select name="score" id="rating-score" required>
                <option value="5">★★★★★ (5점)</option>
                <option value="4">★★★★☆ (4점)</option>
                <option value="3">★★★☆☆ (3점)</option>
                <option value="2">★★☆☆☆ (2점)</option>
                <option value="1">★☆☆☆☆ (1점)</option>
            </select>
            <button type="submit">등록/수정</button>
        </form>
    </div>
    <hr>
{{/isAuthenticated}}


<h2>댓글</h2>

{{#isAuthenticated}}
    <div class="comment-form">
        <form action="/api/cards/{{cardId}}/comments" method="post">
            <textarea name="content" rows="3" placeholder="댓글을 입력하세요..." required></textarea>
            <button type="submit">댓글 작성</button>
        </form>
    </div>
{{/isAuthenticated}}
{{^isAuthenticated}}
    <p><a href="/login">로그인</a> 후 댓글을 작성할 수 있습니다.</p>
{{/isAuthenticated}}


<div class="comments-list">
    {{#comments}}
        <div class="comment">
            <p><strong>{{username}}</strong> <small>({{createdAt}})</small></p>

            <div id="comment-view-{{id}}" class="comment-content">
                <p>{{content}}</p>
            </div>

            <div id="comment-edit-form-{{id}}" class="edit-form hidden">
                <form action="/api/cards/{{cardId}}/comments/{{id}}/update" method="post">
                    <textarea name="content" rows="3">{{content}}</textarea>
                    <button type="submit">수정 완료</button>
                    <button type="button" onclick="toggleEdit('{{id}}')">취소</button>
                </form>
            </div>

            {{#isMine}}
                <div class="actions">
                    <button onclick="toggleEdit('{{id}}')">수정</button>
                    <form action="/api/cards/{{cardId}}/comments/{{id}}/delete" method="post" style="display: inline;">
                        <button type="submit" onclick="return confirm('정말로 삭제하시겠습니까?');">삭제</button>
                    </form>
                </div>
            {{/isMine}}
        </div>
    {{/comments}}
    {{^comments}}
        <p>아직 댓글이 없습니다.</p>
    {{/comments}}
</div>

<script>
    function toggleEdit(commentId) {
        const viewDiv = document.getElementById('comment-view-' + commentId);
        const editFormDiv = document.getElementById('comment-edit-form-' + commentId);

        viewDiv.classList.toggle('hidden');
        editFormDiv.classList.toggle('hidden');
    }
</script>

</body>
</html>